name: "Read the Docs Pull Request Preview"
author: "@readthedocs"
description: "Add a comment with links to the rendered version of the documentation on Read the Docs"

branding:
  color: gray
  icon: robot

inputs:
  project-slug:
    description: "Project's slug on Read the Docs"
    required: true
  project-language:
    description: "Project's language on Read the Docs"
    default: "en"
    required: false
  pretty-urls:
    description: "End links with 'page.html' or 'page/'"
    default: false
    required: false
  path:
    description: "Path where to check for file modifications"
    default: "**"
    required: false
  maximum-links:
    description: "Maximum numbers of links to put in the comment"
    default: 3
    required: false

runs:
  using: "composite"
  steps:
    - name: "Comment on Pull Request with Read the Docs' preview links"
      uses: actions/github-script@v6
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script:  |
          var PR_NUMBER = context.issue.number
          var RTD_PROJECT_SLUG = "${{ inputs.project-slug }}"
          var RTD_PROJECT_LANGUAGE = "${{ inputs.project-language }}"

          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `:robot: https://${RTD_PROJECT_SLUG}--${PR_NUMBER}.org.readthedocs.build/${RTD_PROJECT_LANGUAGE}/${PR_NUMBER}/`
          })
